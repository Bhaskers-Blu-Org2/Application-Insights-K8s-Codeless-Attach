apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: {{ .Values.app.name }}
  {{- template "common.metadata" . }}
webhooks:
  - name: {{ .Values.app.name }}.aks-webhook-ns.svc
    clientConfig:
      service:
        name: {{ .Values.app.name }}
        namespace: {{ .Values.namespace }}
        path: "/"
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUV5RENDQXJDZ0F3SUJBZ0lSQUtRekxWNXlzWmNTU2crd0x4cFFGVEV3RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTVRreE1UQTNNREl3TmpFNVdoY05ORGt4TURNd01ESXhOakU1V2pBTgpNUXN3Q1FZRFZRUURFd0pqWVRDQ0FpSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnSVBBRENDQWdvQ2dnSUJBTldVCjIzNit0eHU5aWRGbVdYeGE1V0pkSUM5amVNbjg1TUZrTWcrcDczaWsvdE15cG1TSUlQZ0VLcERqTWpYbkdGeUQKZ1hFc0lTOXhDT1VrL2ZTZkp3MExWNHY2OHg4M2pDM2xhWkk4MVF2WWp6YjFsVklYQWxWR2JYVURwenZUSitBVgo1RnJyYTVwZ3kxUm1uRUNjOVBXVVJHUkpVR1hZTXNiWkZBMjhYUXRIR1ZhYVhra3Exc3FCbVNUMmtRMHhiTnorCmphZ3VsNkwyQTdxZFRCcDVnNC96TVpjd0F0aWFlbEJuVlIyVXFBOG95aUN2dVpXSXgrc2NHczBLR1QzamIrSDUKVTVkQjBibGlyWHBVTXhDUWdJdlV0dThGQjdCRThRSjZBVXJ3ME9iY3A5R3pzcCtCekV0Q3M4NjlLY3FmN3dwRwpVMlRjK3crS2NmWXFLYzVJSXJFWXozNUp4c1FheTNRZHd0eFdXZHZSVEFPcFBiYllIc1ExbnVkL3h6TjV3UXN3CkV3dXZ4emFqSEh3NFpydzJqZVpGdGQzSXZKZGJzZmE4NnJGaEo3THNIN3J2WUFXUXpvbzRWVlI0OCsyT3hUM0sKTnUxTk4vKy9nRFZmZk0vUHNCekVlRSt4dWVpWVFDZ1V6d2lUb0I4K0tsOUJsd1VyVEUvdlpJOXF0WUN1TTRueAo3LzMydVZuTC9kcmt3ZjNZN0JQa0ROWnRWZ3B5R1ptOWNKa05SVGNlSGhWdTBHU0sweFhKalRNbjR6MmNQVm1YCkI3UzduaDkxdnprVTkyOHNTYkttYlVkOC9xYXFtTkwzTzJpQS9VOVZFbG9nbVRURFJ5STFNS3oyRkVYbkNPZFQKNnVyTmt2WDFleVNOSzZyMTRZOFRwcWhIRTdQV3V2cHdMRnQ0dldKSEFnTUJBQUdqSXpBaE1BNEdBMVVkRHdFQgovd1FFQXdJQ3BEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRRFJhbjB4ClovVmEyVWZWa0hzTFBWN3IvNmV5bStQNmFWaDNScGd5WmdHajVqOHZNdjhjMXE1UlNHSlptZlZoQmZLR1IvY3IKTWRVaWRzNXM1MU0vQU5Ma1dxTDdDTXFKN0FLQnZrcVQvZWVocFpRaU9Sc2c3M3JCRmFXeVI4Sk92UFh6bUtHTgp6SXZIRDROVk11WmRlNzMvMURCUnByVVpaZnV3dG02ZGxuMXp6S0VUV1kvVmFDUE9NcGNyWW03ZGZlT0RPeWxtCmpCVlRkcDRxbDZqajkyYkJOZ1dxTVRDalNhQmdvQzNOUGkrdWNSYlVpU2tUd1NCbUdSZThjMmM2SGVRd3lSSDkKUGlvM0ovUDRnL0lLTVBEcHhMc2xSek1meCtCMXVwKzhCdFp5djdqZVlvSmdObHFUVGZoRmhBZGM0MGQreHdSawoxaWxmajh5L0VyeGZ1ZzkxLy9Nc0FaVUNDWEJ5V0RtNWlnT1hmcitFblhEYWt4RUk2b2pEUkNxWXBSRW4vcVFFCnFyNnRSWWxiZkxxU1JJbW9MWTd6dmZqbnRzaXBEengwaDN0dHdleS9RTkhXRklyL0pjUkYwU3ZYMjl2QXpHOVYKN1Q5RzBxb2dyNEo2UnVPSUFNWjk0MFpkK1VuVFFtaTdEUE1SeXFaTzNMN0RkZzZRMXhnYnVNczVCbTdxUWdPegpHbktHYndFWHh0bTBhTjhFeXRucmpLMXVnTGROeUpSTDdaTnFXV2Jhem5SMUFxa2thT0JDUVZ3TEMrd3JGdWtsCkw3M0NoVkZCVFpiTHE4clRONmJQTlp3LzNGcjIxaU5XcTRWMi9LbnMxeS9pREp0dVFJMThyeUZEYmduRkY1RmcKZUdEaDZybm13dkl1YTNMYWM4dUQ3U3VWZ05QWjR4UTVlTS96N3c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["pods"] 
    failurePolicy: Ignore
    namespaceSelector:
      matchLabels:
        mutating-webhook: enabled