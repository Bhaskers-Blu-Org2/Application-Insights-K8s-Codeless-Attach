apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: {{ .Values.app.name }}
  {{- template "common.metadata" . }}
webhooks:
  - name: {{ .Values.app.name }}.aks-webhook-ns.svc
    clientConfig:
      service:
        name: {{ .Values.app.name }}
        namespace: {{ .Values.namespace }}
        path: "/"
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUV5RENDQXJDZ0F3SUJBZ0lSQUlkalM2d1Vkd3B1VTFXNWs4THRzNTR3RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTVRreE1URXdNak0xTlRFM1doY05ORGt4TVRBek1EQXdOVEUzV2pBTgpNUXN3Q1FZRFZRUURFd0pqWVRDQ0FpSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnSVBBRENDQWdvQ2dnSUJBTWhjCmhKUGJJM1dZQ3VRendXQlZtSW90bGpqWDAvZytHUENwMWJPMi9uQWF0R3VXRnAvekJGNThCVU1Gdi9BbEZmd3EKalBDckF6SlNPNmhKUXU4L1Zqc2FQMWd1cjFEa1h6SXYzVXZJWmxrZklhWjFnSlhML2JZaUpWdVJIY2NqVTV3UgpsS2piWE9HL1RhMTFCNEw3QTc1MitGcGRtWXlEUE5JNWFlb2Y2eGJ4cnF1NWU1TTgzZkpuQzR2RldURFU2aVN3ClovL2Q4T2w5VHlISXM0Z1hKVGRScEZzSzJ0S2JKU3l2eTRSa1AzTVFuLzJ2VnByTm9iQjcrcTFaMGEwZHB5M1QKMEJhdTNrY0hlc1RyUVFXK2dka3dHeWFScENtdDBJWHJ5aUREYWZzWWc3c1doeGZrN1p4cU1LenM5Y2RJL1h2eQpqQ3JQUVJoaGRHS3FxWGdRZWlDKy9WUmt4NmEyVzNnUnpkdjdpQkdvV0prbkxlRnJ5bWgyMGVHdGJmMUJEVFY4ClBCWk9QbWVFWGtVY2NablVUTWMvMlhGZ2FVZGp2Yi96ZmsyYW0yanJta0l1UC8wRmZEUlhpUG93QnNwYzBNNlAKMUpZSWZPTkgxaHcrVnhtT05VRlJYT1B5dFRlaUNsNEkzaVhlSWFhS3E1aGdJeTFsQ01zblRWY1NIT0VUL24xcQpkZDRXOU5GZ21OS3lrcjRaMXpPbkVsb2lGbEh0SlhNRytYejdtNFRzU1ZqeEg4NkVkQ21STURzMjlzMy9YNGxlCjl0VWZ3dWNiVE05QWMzYUphc2FxSmJNVmw4KzlJeG5QUFdnTkM2cEVnaE93WEVyOHhveGlLd1dEaVZNanRYK3QKaWhGN3pCQkplcy96UDl3dTd2eEtidWorZ00rQVpCQ2MvSk9SeHZuN0FnTUJBQUdqSXpBaE1BNEdBMVVkRHdFQgovd1FFQXdJQ3BEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQ00yNkhYCk5Uc3d4dE5WZC8vSm1PUFdxZ1M5ZXRGaU4zeCtFdVRENWtodkFvbGg4WXg5a2NkNjQ1T09GOFN2VlY5aWp6dGYKenVkQkZRSHhhc1Q1bkhlaWZEU1R3LzhHTUFhbUNRaXVmVGhjNzE4ZnJwUWxxSXRKSHZncnhsYnNxSFVWK2JMagpHRE14WVlpNVJEUVNPYWFPK01KRytNeXczMmdVQis4VmM3MjVURlE0RTYvQmZLcmpNejd6VThkNmZNOUJQRW54Cm8zYjlteWYvSzB6cnd1SkFKRTA2YjFFUnNwdElBc0N4eURuQTBsSGFmUm1uelM2bG5rd2VMaTVYeGFtTU01RGcKSFdZY1BOTml3ZGpxQUg1OFlicUNDQjBTekRKamRXeDVOd3QyYjFDd21vd1BrL2lBa2lIbVNNZjMxalJpWk9oMQpGZWx5bzBkb2N6SjlzM3l0cXp3aHQzMHQ4OVNYaG10WVBwYXBEZXNrOVkwQ1ZPK08rUUp4bGZoK3NXSHFBaGlZClhsMk94ZHZ2UmdkOUxhY1pPQSs0em9VNzJseUZrejZtUEhpNENjckdYaHVvMkF0TG1KTkdPdDVGZUhONVgzeDQKbzJ3V3JiRHVZbFFvM3NNdFFnbWczZkpJSC82YUg3MlplTmdrQlFobjMvSFB2S3ZLMUJsdnhXRXRFdGFmWWVUMwpjQVZBa21pL2ZhdnhtTlMyTTQvRmlCNksxaGk2ZGNLTU0wNkhmZXVpeGpQV0VZYVNmU0tIK2dRQnh1bnZ6ZjVECjlpZFJBQmZVMmJVc0Y5dFlNcmRmN0JZT2xtS3F2QzEvemwyZmtSZTNDMlRYQ05BamtMSmNQeFdvQ2VSU0pFTDQKWXJqQWJNMlEyOXo5dmxOazNXZXZPcDJ5ejh5b1NmemNVM08yNEE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
    rules:
      - operations: ["CREATE", "UPDATE"]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["pods"] 
    failurePolicy: Ignore
    namespaceSelector:
      matchLabels:
        mutating-webhook: enabled